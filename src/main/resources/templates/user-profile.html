<!--
  ~ IceWheel Energy
  ~ Copyright (C) 2025 IceWheel LLC
  ~
  ~ This program is free software: you can redistribute it and/or modify
  ~ it under the terms of the GNU General Public License as published by
  ~ the Free Software Foundation, either version 3 of the License, or
  ~ (at your option) any later version.
  ~
  ~ This program is distributed in the hope that it will be useful,
  ~ but WITHOUT ANY WARRANTY; without even the implied warranty of
  ~ MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  ~ GNU General Public License for more details.
  ~
  ~ You should have received a copy of the GNU General Public License
  ~ along with this program.  If not, see <https://www.gnu.org/licenses/>.
  ~
  -->

<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head th:replace="~{fragments/header :: head(pageTitle='Dashboard')}"></head>

<body class="d-flex flex-column min-vh-100 bg-body-tertiary">
    <nav th:replace="~{fragments/header :: navbar(activePage='dashboard')}"></nav>

    <main class="container my-5 flex-grow-1">

        <!-- Case 1: Tesla account is NOT connected -->
        <div th:if="${!teslaConnected}" class="text-center p-5 bg-body-tertiary rounded-3">
            <i class="bi bi-stars display-3 text-primary"></i>
            <h1 class="display-5 fw-bold mt-3">Unlock Your Home's Energy Potential</h1>
            <p class="col-lg-8 mx-auto fs-5 text-muted">
                Connect your Tesla account to automate your energy usage, maximize savings, and gain full control over your Powerwall and solar systems.
            </p>
            <div class="d-flex flex-wrap gap-4 justify-content-center my-4">
                <div class="d-flex align-items-center gap-2 text-muted">
                    <i class="bi bi-robot fs-4"></i>
                    <span>Automate Charging</span>
                </div>
                <div class="d-flex align-items-center gap-2 text-muted">
                    <i class="bi bi-graph-up-arrow fs-4"></i>
                    <span>Monitor Live Status</span>
                </div>
                <div class="d-flex align-items-center gap-2 text-muted">
                    <i class="bi bi-currency-dollar fs-4"></i>
                    <span>Reduce Energy Costs</span>
                </div>
            </div>
            <a href="/api/tesla/fleet/auth/url" class="btn btn-primary btn-lg mt-3">
                <i class="bi bi-plug-fill me-2"></i>
                Securely Connect to Tesla
            </a>
        </div>

        <!-- Case 2: Tesla account IS connected -->
        <div th:if="${teslaConnected}">
            <!-- Welcome Header -->
            <div class="d-flex justify-content-between align-items-center mb-4">
                <div>
                    <h1 class="display-6" th:text="|Welcome back, ${#authentication.principal.attributes['given_name']}|">Welcome back!</h1>
                    <p class="text-muted mb-0">Here's a quick overview of your energy ecosystem.</p>
                </div>
                <div class="alert alert-success d-inline-flex align-items-center p-2 mb-0" role="alert">
                    <i class="bi bi-check-circle-fill me-2"></i>
                    <small>Tesla Account Connected</small>
                </div>
            </div>

            <!-- Main Action Cards -->
            <div class="row row-cols-1 row-cols-lg-3 g-4">

                <!-- Card 1: Energy Products (Primary) -->
                <div class="col">
                    <div class="card h-100 shadow-sm text-bg-primary border-0">
                        <div class="card-body d-flex flex-column">
                            <div class="d-flex align-items-start mb-3">
                                <i class="bi bi-lightning-charge-fill fs-2 me-3"></i>
                                <div>
                                    <h5 class="card-title mb-0">My Energy Products</h5>
                                    <p class="card-text opacity-75">View live status, control your Powerwall, and see historical data.</p>
                                </div>
                            </div>
                            <div class="mt-auto">
                                <a href="/products" class="btn btn-light stretched-link">Go to Products <i class="bi bi-arrow-right"></i></a>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Card 2: Automation Schedules -->
                <div class="col">
                    <div class="card h-100 shadow-sm">
                        <div class="card-body d-flex flex-column">
                            <div class="d-flex align-items-start mb-3">
                                <i class="bi bi-calendar-check-fill fs-2 text-success me-3"></i>
                                <div>
                                    <h5 class="card-title mb-0">Automation Schedules</h5>
                                    <p class="card-text text-muted">Optimize energy costs by scheduling when your Powerwall charges from the grid.</p>
                                </div>
                            </div>
                            <div class="mt-auto">
                                <a href="/schedules" class="btn btn-outline-success stretched-link">Manage Schedules</a>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Card 3: API Tokens -->
                <div class="col">
                    <div class="card h-100 shadow-sm">
                        <div class="card-body d-flex flex-column">
                            <div class="d-flex align-items-start mb-3">
                                <i class="bi bi-key-fill fs-2 text-secondary me-3"></i>
                                <div>
                                    <h5 class="card-title mb-0">Developer API</h5>
                                    <p class="card-text text-muted">Manage your API tokens for custom integrations and scripts.</p>
                                </div>
                            </div>
                            <div class="mt-auto">
                                <a href="/token-details" class="btn btn-outline-secondary stretched-link">Manage Tokens</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recent Activity Section -->
            <div class="mt-5">
                <h4 class="mb-3">Recent Activity</h4>
                <div class="list-group">
                    <a href="/schedules/executions" class="list-group-item list-group-item-action d-flex gap-3 py-3">
                        <i class="bi bi-robot fs-2 text-info"></i>
                        <div class="d-flex gap-2 w-100 justify-content-between">
                            <div>
                                <h6 class="mb-0">Schedule Trigger Log</h6>
                                <p class="mb-0 opacity-75">Review a complete log of every time a schedule has been automatically executed.</p>
                            </div>
                            <small class="opacity-50 text-nowrap"><i class="bi bi-box-arrow-up-right"></i></small>
                        </div>
                    </a>
                    <a href="/schedules/history" class="list-group-item list-group-item-action d-flex gap-3 py-3">
                        <i class="bi bi-clock-history fs-2 text-secondary"></i>
                        <div class="d-flex gap-2 w-100 justify-content-between">
                            <div>
                                <h6 class="mb-0">Configuration Change History</h6>
                                <p class="mb-0 opacity-75">See all changes made to your schedules, including creations, updates, and deletions.</p>
                            </div>
                            <small class="opacity-50 text-nowrap"><i class="bi bi-box-arrow-up-right"></i></small>
                        </div>
                    </a>
                </div>
            </div>

        </div>

    </main>

    <footer th:replace="~{fragments/footer :: page_footer}"></footer>
    <div th:replace="~{fragments/footer :: scripts}"></div>
</body>
</html>
